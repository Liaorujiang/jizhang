---
import Layout from '../layouts/Layout.astro';
---

<Layout>
  <div class="max-w-md mx-auto bg-white rounded-lg shadow-md p-6">
    <h1 class="text-2xl font-bold text-gray-800 mb-6 text-center">登录</h1>
    
    <!-- 错误提示 -->
    <div id="error-message" class="p-4 bg-red-50 border border-red-200 rounded-md mb-6 hidden">
      <p class="text-red-800" id="error-text"></p>
    </div>
    
    <form id="login-form" class="space-y-6">
      <div>
        <label for="email" class="block text-sm font-medium text-gray-700 mb-1">邮箱</label>
        <input type="email" id="email" name="email" class="w-full pl-3 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="请输入邮箱" required>
      </div>
      
      <div>
        <label for="password" class="block text-sm font-medium text-gray-700 mb-1">密码</label>
        <input type="password" id="password" name="password" class="w-full pl-3 pr-3 py-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-blue-500 focus:border-transparent" placeholder="请输入密码" required>
      </div>
      
      <div class="flex items-center justify-between">
        <div class="flex items-center">
          <input type="checkbox" id="remember" name="remember" class="h-4 w-4 text-blue-600">
          <label for="remember" class="ml-2 text-sm text-gray-700">记住我</label>
        </div>
        <a href="#" class="text-sm text-blue-600 hover:text-blue-800">忘记密码？</a>
      </div>
      
      <div>
        <button type="submit" class="w-full px-4 py-2 bg-blue-600 text-white rounded-md hover:bg-blue-700 transition-colors">
          登录
        </button>
      </div>
      
      <div class="text-center">
        <p class="text-sm text-gray-700">
          还没有账号？ <a href="/register" class="text-blue-600 hover:text-blue-800">立即注册</a>
        </p>
      </div>
    </form>
  </div>
  
  <script>
    // 处理表单提交
    async function handleSubmit(e) {
      e.preventDefault();
      
      // 获取表单数据
      const formData = new FormData(e.target);
      const email = formData.get('email');
      const password = formData.get('password');
      
      try {
        // 发送登录请求
        const response = await fetch('/api/auth/login', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json'
          },
          body: JSON.stringify({ email, password })
        });
        
        const data = await response.json();
        
        if (data.success) {
          // 登录成功，跳转到首页
          window.location.href = '/';
        } else {
          // 登录失败，显示错误信息
          const errorMessage = document.getElementById('error-message');
          const errorText = document.getElementById('error-text');
          errorText.textContent = data.error || '邮箱或密码错误';
          errorMessage.classList.remove('hidden');
        }
      } catch (error) {
        console.error('登录错误:', error);
        // 网络错误，显示错误信息
        const errorMessage = document.getElementById('error-message');
        const errorText = document.getElementById('error-text');
        errorText.textContent = '网络错误，请稍后重试';
        errorMessage.classList.remove('hidden');
      }
    }
    
    // 页面加载完成后执行
    document.addEventListener('DOMContentLoaded', function() {
      const form = document.getElementById('login-form');
      if (form) {
        form.addEventListener('submit', handleSubmit);
      }
    });
  </script>
</Layout>